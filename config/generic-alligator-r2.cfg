# This file contains common pin mappings for Alligator (Rev.2) board.  
# To use this config, the firmware should be compiled for the Arduino
# Due.
# Remember:
# ^ = use pull-up;
# ! = invert signal;
# Flash procedure:
# sudo /etc/init.d/alligator-manager --erase
# sudo bossac -e -w -v -b -R -i -p ttyAMA0 klipper.bin
#
# see alligator github for alligator manager

# See docs/Config_Reference.md for a description of parameters.

[virtual_sdcard]
path: ~/sdcard

[pause_resume]
[display_status]

[static_digital_output DRV8825_microstepping] 
pins:PC10
pins:PC29
pins:PC19
pins:PC18

[dac084S085 my_digipot]
enable_pin: PB14
spi_bus : spi0
motor1 : 100
motor2 : 100
motor3 : 90
motor4 : 90

[stepper_x]
step_pin: PB24
dir_pin: !PB25
enable_pin: !PA15
microsteps = 32
rotation_distance: 16
endstop_pin: ^!PC5
position_endstop: -30
position_max: 220
position_min: -30
homing_speed: 50

[stepper_y]
step_pin: PB22
dir_pin: !PB23
enable_pin: !PA15
microsteps = 32
rotation_distance: 16
endstop_pin: ^!PC3 
position_endstop: -8
position_min: -8
position_max: 220
homing_speed: 50

[stepper_z]
step_pin: PC27
dir_pin: PC28
enable_pin: !PA15
microsteps = 32
rotation_distance: 4
endstop_pin: ^!PC2
position_endstop: 0
position_max: 240
position_min: -1

[extruder]
step_pin: PC25
dir_pin: PC26
enable_pin: !PA15
microsteps = 32
rotation_distance: 4
full_steps_per_rotation = 400 # 0.9 deg Motor
rotation_distance = 7.82
max_extrude_only_distance = 1400.0
max_extrude_only_velocity = 2000
max_extrude_only_accel = 1500
nozzle_diameter = 0.400
filament_diameter = 1.750
heater_pin: PA1
sensor_pin: PA16 # PA16(near mcu) or PA24(near ethernet)
sensor_type: ATC Semitec 104NT-4-R025H42G
control: pid
pid_kp: 15.572
pid_ki: 0.446
pid_kd: 136.064
min_temp: 0
max_temp: 270

#[extruder1]
#step_pin: PD3
#dir_pin: !PD2
#enable_pin: !PA15
#microsteps = 32
#heater_pin: PC22
#sensor_pin: PB25

#[extruder2]
#step_pin: PD7
#dir_pin: !PD6
#enable_pin: !PA15
#microsteps = 32
#heater_pin: PC21
#sensor_pin: PC28

#[extruder3]
#step_pin: PD9
#dir_pin: !PD8
#enable_pin: !PA15
#microsteps = 32
#heater_pin: PA29
#sensor_pin: PC5

[heater_bed]
heater_pin: PA0
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PA24 # pin puo' essere PA16(vicino a mcu) o PA24(vicino a ethernet)
control: pid
pid_kp: 73.517
pid_ki: 1.132
pid_kd: 1193.728
min_temp: 0
max_temp: 130

[heater_fan my_hotend_fan]
pin: PA5
kick_start_time: 1
heater: extruder
heater_temp: 50.0
fan_speed: 1.0

[fan]
pin: PA7
kick_start_time: 0.5

[mcu]
serial = /dev/ttyAMA0
baud = 250000
restart_method = command

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 1000
max_z_velocity: 20
max_z_accel: 100

[bltouch]
sensor_pin: ^PC6
control_pin: PC4
pin_move_time = 0.500
pin_up_reports_not_triggered = True
pin_up_touch_mode_reports_triggered = False
z_offset: 0.72
x_offset: 24
y_offset: -14
speed: 10
samples: 5
sample_retract_dist = 6
samples_result = average

[display]
lcd_type = st7920
cs_pin = PA11 	# LCD_RS
sclk_pin = PA10	# LCD_D4
sid_pin = PD5 	# LCD_E
encoder_pins = ^PD4,^PA13 	# BTN_EN1,BTN_EN2
click_pin = ^!PA12 		# BTN_ENC
#kill_pin
menu_timeout = 60

[output_pin BEEPER_pin]
pin = PB19
pwm = True
value = 0
shutdown_value = 0
cycle_time = 0.1
scale = 1000
